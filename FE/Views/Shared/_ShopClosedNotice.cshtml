@{
    Layout = null;

    var now = DateTime.Now.TimeOfDay;
    var start = new TimeSpan(23, 0, 0); // 23:00
    var end = new TimeSpan(7, 15, 0);   // 07:15
    // Test tạm khoảng 6h00 đến 7h15 sáng
    // var start = new TimeSpan(1, 0, 0);   // 06:00
    // var end = new TimeSpan(7, 15, 0);  // 07:15

    bool isClosed = start <= now || now <= end;
}

<!-- Thông báo đóng cửa -->
@if (isClosed)
{
    <div id="shopClosedNotice"
         style="position:fixed;top:0;left:0;width:100%;height:100%;
                        background:rgba(0,0,0,0.5);display:flex;justify-content:center;
                        align-items:center;z-index:9999;backdrop-filter:blur(3px);">
        <div style="background:#fff8f0;padding:30px 40px;border-radius:15px;
                            max-width:500px;text-align:center;position:relative;
                            box-shadow:0 8px 20px rgba(0,0,0,0.3);font-family:Segoe UI, sans-serif;">
            <h2 style="color:#ff6f61;margin-bottom:15px;">Chào bạn!</h2>
            <p style="color:#555;font-size:16px;line-height:1.6;">
                Hiện tại, cửa hàng đang nghỉ ngơi từ <strong>23:00</strong> đến <strong>07:15</strong> sáng.
            </p>
           @*  Test thì mở command ra nhé ae
            <button onclick="closeShopNotice()"
                    style="margin-top:20px;padding:10px 25px;background:#ff6f61;color:white;
                                   border:none;border-radius:8px;font-size:15px;
                                   cursor:pointer;transition:all 0.3s;">
                Đóng
            </button> *@
        </div>
    </div>
}

<!-- Thông báo voucher -->
<div id="voucherNotice"
     style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;
            background:rgba(0,0,0,0.5);justify-content:center;align-items:center;
            z-index:9998;backdrop-filter:blur(3px);">
    <div style="background:#fff3cd;padding:30px 40px;border-radius:15px;
                max-width:500px;text-align:left;position:relative;
                box-shadow:0 8px 20px rgba(0,0,0,0.3);font-family:Segoe UI, sans-serif;
                border:1px solid #ffeeba;color:#856404;">
        <div id="voucherContent"
             style="font-size:15px;">
        </div>
        <div style="text-align:right;margin-top:10px;">
            <button onclick="document.getElementById('voucherNotice').style.display='none'"
                    style="padding:5px 15px;background:#DD0000;color:#fff;
                           border:none;border-radius:5px;font-size:14px;cursor:pointer;">
                Đóng
            </button>
        </div>
    </div>
</div>

<script>
    // Đóng thông báo cửa hàng rồi mới hiển thị voucher
    function closeShopNotice() {
        const shopNotice = document.getElementById('shopClosedNotice');
        if (shopNotice) {
            shopNotice.style.display = 'none';
        }
        showVoucherNotice();
    }

    // Hiển thị voucher
    async function showVoucherNotice() {
        const customerId = getCustomerId();
        if (!customerId) return;

        try {
            const response = await fetch(`https://localhost:7169/api/BanHangTK/vouchers/${customerId}`);
            if (!response.ok) throw new Error("API error " + response.status);

            const vouchers = await response.json();
            if (vouchers.length === 0) return;

            const voucherContent = document.getElementById("voucherContent");
            voucherContent.innerHTML = "";

            vouchers.forEach(v => {
                const ngayKetThuc = new Date(v.ngay_Ket_Thuc).toLocaleDateString("vi-VN");
                const item = `
                    <p>
                        Voucher <strong>${v.ten}</strong> - Giảm <strong>${v.gia_Tri_Giam}%</strong><br/>
                        HSD: <strong>${ngayKetThuc}</strong>
                    </p>
                `;
                voucherContent.innerHTML += item;
            });

            // Thêm câu kết thúc
            voucherContent.innerHTML += `
                <p><em>Hãy nhanh tay mua tà tưa ở <strong>TheBoy</strong> tụi mình để nhận thêm nhiều voucher nữa nhé!</em></p>
            `;

            document.getElementById("voucherNotice").style.display = "flex";
        } catch (err) {
            console.error("Lỗi lấy voucher:", err);
        }
    }

    document.addEventListener("DOMContentLoaded", function () {
        // Nếu đang trong giờ đóng cửa thì chỉ hiển thị notice, voucher sẽ hiển thị sau khi user bấm "Đóng"
        const shopNotice = document.getElementById('shopClosedNotice');
        if (!shopNotice) {
            // Không trong giờ đóng cửa -> show voucher ngay
            showVoucherNotice();
        }
    });
</script>

